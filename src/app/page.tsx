//import Image from "next/image";
"use client"
import { useState, useEffect } from "react";
import TaskForm from "./components/TaskForm";
import TaskList from "./components/TaskList";
import { Task } from "./interfaces/task";

//Corresponde a la razís
export default function Home() {

  const [tasks, setTasks] = useState<Task[]>([]);

  const loadTasks = () => {
    try {
      const stored = localStorage.getItem("tasks");
      if (stored) {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed)) {
          setTasks(parsed);
        } else {
          console.warn("Formato inválido en localStorage. Se limpiará.");
          localStorage.removeItem("tasks");
          setTasks([]);
        }
      }
    } catch (error) {
      console.error("Error leyendo localStorage:", error);
      localStorage.removeItem("tasks");
      setTasks([]);
    }
  };

  useEffect(() => {
    loadTasks();

    const handleStorageChange = (event: StorageEvent) => {
      if (event.key === "tasks") {
        loadTasks();
      }
    };
    window.addEventListener("storage", handleStorageChange);

    return () => window.removeEventListener("storage", handleStorageChange);
  }, []);

  useEffect(() => {
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }, [tasks]);

  const addTask = (task: Task) => {
    setTasks((prev) => [...prev, task]);
  };

  const updateTask = (updatedTask: Task) => {
    setTasks((prev) => prev.map((task) => (task.id === updatedTask.id ? updatedTask : task)));
  };

  const deleteTask = (id: string) => {
    setTasks((prev) => prev.filter((task) => task.id !== id));
  };
  return (
    <>
      <div className="mx-auto grid max-w-2xl grid-cols-1 items-center gap-x-8 gap-y-16 px-4 py-24 sm:px-6 sm:py-32 lg:max-w-7xl lg:grid-cols-2 lg:px-8">
        <div>
          <h2 className="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Tasky app example</h2>
          <p className="mt-4 text-gray-500">
            Tu app de tareas de ejemplo
          </p>


        </div>
        <div className="rounded-lg bg-gray-100 grid grid-cols-2 grid-rows-2 gap-4 sm:gap-6 lg:gap-8">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512">
            <path d="M 200 16 Q 186 16 177 25 L 177 25 L 177 25 Q 168 34 168 48 L 168 335 L 168 335 Q 168 341 163 343 Q 158 345 154 341 L 95 281 L 95 281 Q 85 272 72 272 Q 59 272 49 281 Q 40 291 40 304 Q 40 317 49 327 L 153 430 L 153 430 Q 185 462 226 479 Q 267 496 312 496 L 320 496 L 320 496 Q 383 495 425 454 Q 467 413 472 352 Q 472 351 472 350 Q 472 350 472 350 L 472 344 L 472 344 L 472 112 L 472 112 Q 472 98 463 89 Q 454 80 440 80 Q 426 80 417 89 Q 408 98 408 112 L 408 184 L 408 184 L 408 240 L 408 240 L 408 304 L 408 304 Q 407 324 394 338 Q 380 351 360 352 Q 334 351 320 331 Q 306 351 280 352 Q 260 351 246 338 Q 233 324 232 304 L 232 208 L 232 208 L 232 88 L 232 88 L 232 88 L 232 88 L 232 48 L 232 48 Q 232 34 223 25 Q 214 16 200 16 L 200 16 Z M 312 304 L 312 240 L 312 304 L 312 240 L 312 216 L 312 216 L 312 208 L 312 208 Q 312 194 303 185 Q 294 176 280 176 Q 266 176 257 185 Q 248 194 248 208 L 248 304 L 248 304 Q 248 318 257 327 Q 266 336 280 336 Q 294 336 303 327 Q 312 318 312 304 L 312 304 Z M 328 240 L 328 304 L 328 240 L 328 304 Q 328 318 337 327 Q 346 336 360 336 Q 374 336 383 327 Q 392 318 392 304 L 392 240 L 392 240 Q 392 226 383 217 Q 374 208 360 208 Q 346 208 337 217 Q 328 226 328 240 L 328 240 Z M 392 204 L 392 184 L 392 204 L 392 184 L 392 112 L 392 112 Q 393 92 406 78 Q 420 65 440 64 Q 460 65 474 78 Q 487 92 488 112 L 488 344 L 488 344 L 488 352 L 488 352 Q 488 353 488 354 Q 482 422 435 466 Q 389 510 320 512 L 312 512 L 312 512 Q 263 512 220 494 Q 176 476 142 442 L 38 338 L 38 338 Q 24 323 24 304 Q 24 285 38 270 Q 53 256 72 256 Q 91 256 106 270 L 152 316 L 152 316 L 152 48 L 152 48 Q 153 28 166 14 Q 180 1 200 0 Q 220 1 234 14 Q 247 28 248 48 L 248 88 L 248 88 L 248 172 L 248 172 Q 261 160 280 160 Q 299 160 313 173 Q 326 185 328 204 Q 341 192 360 192 Q 379 192 392 204 L 392 204 Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512">
            <path d="M 73.14285714285714 0 Q 42.285714285714285 1.1428571428571428 21.714285714285715 21.714285714285715 L 21.714285714285715 21.714285714285715 L 21.714285714285715 21.714285714285715 Q 1.1428571428571428 42.285714285714285 0 73.14285714285714 L 0 438.85714285714283 L 0 438.85714285714283 Q 1.1428571428571428 469.7142857142857 21.714285714285715 490.2857142857143 Q 42.285714285714285 510.85714285714283 73.14285714285714 512 L 438.85714285714283 512 L 438.85714285714283 512 Q 469.7142857142857 510.85714285714283 490.2857142857143 490.2857142857143 Q 510.85714285714283 469.7142857142857 512 438.85714285714283 L 512 73.14285714285714 L 512 73.14285714285714 Q 510.85714285714283 42.285714285714285 490.2857142857143 21.714285714285715 Q 469.7142857142857 1.1428571428571428 438.85714285714283 0 L 73.14285714285714 0 L 73.14285714285714 0 Z M 114.28571428571429 284.57142857142856 Q 89.14285714285714 257.14285714285717 89.14285714285714 222.85714285714286 L 89.14285714285714 222.85714285714286 L 89.14285714285714 222.85714285714286 Q 89.14285714285714 187.42857142857142 114.28571428571429 161.14285714285714 Q 140.57142857142858 136 174.85714285714286 136 Q 209.14285714285714 136 235.42857142857142 161.14285714285714 L 256 181.71428571428572 L 256 181.71428571428572 L 276.57142857142856 161.14285714285714 L 276.57142857142856 161.14285714285714 Q 302.85714285714283 136 337.14285714285717 136 Q 371.42857142857144 136 397.7142857142857 161.14285714285714 Q 422.85714285714283 187.42857142857142 422.85714285714283 222.85714285714286 Q 422.85714285714283 257.14285714285717 397.7142857142857 284.57142857142856 L 282.2857142857143 402.2857142857143 L 282.2857142857143 402.2857142857143 Q 270.85714285714283 413.7142857142857 256 413.7142857142857 Q 241.14285714285714 413.7142857142857 230.85714285714286 402.2857142857143 L 114.28571428571429 284.57142857142856 L 114.28571428571429 284.57142857142856 Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512">
            <path d="M 146.28571428571428 512 Q 213.71428571428572 509.7142857142857 256 462.85714285714283 Q 298.2857142857143 509.7142857142857 365.7142857142857 512 Q 427.42857142857144 510.85714285714283 469.7142857142857 469.7142857142857 Q 510.85714285714283 427.42857142857144 512 365.7142857142857 Q 509.7142857142857 298.2857142857143 462.85714285714283 256 Q 509.7142857142857 213.71428571428572 512 146.28571428571428 Q 510.85714285714283 84.57142857142857 469.7142857142857 42.285714285714285 Q 427.42857142857144 1.1428571428571428 365.7142857142857 0 Q 298.2857142857143 2.2857142857142856 256 49.142857142857146 Q 213.71428571428572 2.2857142857142856 146.28571428571428 0 Q 84.57142857142857 1.1428571428571428 42.285714285714285 42.285714285714285 Q 1.1428571428571428 84.57142857142857 0 146.28571428571428 Q 2.2857142857142856 213.71428571428572 49.142857142857146 256 Q 2.2857142857142856 298.2857142857143 0 365.7142857142857 Q 1.1428571428571428 427.42857142857144 42.285714285714285 469.7142857142857 Q 84.57142857142857 510.85714285714283 146.28571428571428 512 L 146.28571428571428 512 Z M 256 164.57142857142858 Q 307.42857142857144 165.71428571428572 334.85714285714283 210.28571428571428 Q 360 256 334.85714285714283 301.7142857142857 Q 307.42857142857144 346.2857142857143 256 347.42857142857144 Q 204.57142857142858 346.2857142857143 177.14285714285714 301.7142857142857 Q 152 256 177.14285714285714 210.28571428571428 Q 204.57142857142858 165.71428571428572 256 164.57142857142858 L 256 164.57142857142858 Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512">
            <path d="M 304 19 L 304 128 L 304 19 L 304 128 Q 305 169 332 196 Q 359 223 400 224 Q 441 223 468 196 Q 495 169 496 128 L 496 19 L 496 19 Q 496 16 493 16 Q 492 16 491 17 L 459 55 L 459 55 Q 452 64 441 64 L 360 64 L 360 64 Q 348 64 341 55 L 309 17 L 309 17 Q 308 16 307 16 Q 304 16 304 19 L 304 19 Z M 307 0 Q 316 0 321 7 L 353 45 L 353 45 Q 356 48 359 48 L 440 48 L 440 48 Q 444 48 447 45 L 479 7 L 479 7 Q 484 0 493 0 Q 510 2 512 19 L 512 128 L 512 128 Q 511 176 479 207 Q 448 239 400 240 Q 352 239 321 207 Q 289 176 288 128 L 288 19 L 288 19 Q 290 2 307 0 L 307 0 Z M 80 335 Q 103 274 151 232 L 151 232 L 151 232 Q 198 189 264 174 Q 266 182 270 189 Q 185 209 133 273 Q 82 337 80 424 L 80 440 L 80 440 Q 81 464 96 480 Q 112 495 136 496 L 152 496 L 323 496 Q 335 495 336 483 Q 336 468 326 458 Q 316 448 301 448 L 256 448 L 256 448 Q 249 447 248 440 L 248 440 L 248 440 L 248 400 L 248 400 Q 247 380 234 366 Q 220 353 200 352 L 168 352 L 168 352 Q 161 351 160 344 Q 161 337 168 336 L 200 336 L 200 336 Q 227 337 245 355 Q 263 373 264 400 L 264 413 L 264 413 L 372 306 L 372 306 Q 376 303 381 305 Q 386 307 386 312 L 386 473 L 386 473 Q 388 494 409 496 Q 430 494 432 473 L 432 268 L 432 268 Q 440 267 448 264 L 448 473 L 448 473 Q 448 490 437 501 Q 426 512 409 512 Q 392 512 381 501 Q 370 490 370 473 L 370 331 L 370 331 L 267 432 L 267 432 L 301 432 L 301 432 Q 323 433 337 447 Q 351 461 352 483 Q 352 495 343 503 Q 335 512 323 512 L 296 512 L 136 512 Q 105 511 85 491 Q 65 471 64 440 L 64 424 L 64 424 L 64 169 L 64 169 Q 64 147 50 131 Q 36 116 15 113 L 7 112 L 7 112 Q 0 110 0 103 Q 2 96 9 96 L 17 97 L 17 97 Q 44 101 62 121 Q 79 141 80 169 L 80 335 L 80 335 Z M 352 128 Q 353 113 368 112 Q 383 113 384 128 Q 383 143 368 144 Q 353 143 352 128 L 352 128 Z M 432 112 Q 447 113 448 128 Q 447 143 432 144 Q 417 143 416 128 Q 417 113 432 112 L 432 112 Z" />
          </svg>

        </div>
      </div>
      <div className="container mx-auto">
        <div className="grid grid-rows-4 grid-flow-col gap-7">
          <TaskList tasks={tasks} updateTask={updateTask} deleteTask={deleteTask} />
        </div>
        <div className="grid grid-rows-4 grid-flow-col gap-7">
          <TaskForm addTask={addTask} />
        </div>

      </div>
    </>
  )
}
